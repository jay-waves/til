---
source: https://www.cnblogs.com/zhuowangy2k/p/12245558.html
copyright:
  - WangZhuo2000 (2020)
---

## NAF

非相邻形式 (Non-Adjacent Form, NAF) 是一种将整数表示为二进制加权和的表示形式, 其特点是系数仅包含 {-1, 0, 1} 且不存在连续的非零系数. 这种表示法具有稀疏性质, 使得在计算过程中非零系数的数量较少, 从而提高计算效率. 

在整数 $n$ 的一般二进制表示中, $1$ 的数量大概是 $m=\mathrm{len}(n)/2\approx \log(n)/2$. 

计算 [快速模幂算法](快速模幂算法.md) 时, 使用的操作数为 $\frac{m}{2}\times A+m\times D$, 其中 A 是模乘操作, D 是倍乘 (平方) 操作. 平方操作只需二进制左移 (较小整数时), 模乘需要乘法器.

用 NAF 表示的整数 $n$, 非零数量约为 $\frac{m}{3}$, 所以操作数为 $\frac{m}{3}\times A+m\times D$, 减少了更费时的模乘操作. 注意, 由于引入了 $-1$, 还需要额外的除法.

### 求 NAF 伪代码

算法的核心思路是两位二进制奇数, 只有 1 和 3 两种情况. 在模 4 的情形下, 分别可转化为 1 和 -1.

```
INPUT: 正数k
OUTPUT: NAF(k)

while k >= 1 do:
	if k is odd:
		k_i <-  2 - (k mod 4);
		k <- k - k_i;
	else:
		k_i <- 0;
	
	k >> 1; // k/2
```

### NAF 非零位密度

NAF 非零位密度为 1/3 的原因在于其稀疏性质, 即不存在连续的非零位.  
直接证明复杂, 可以用统计概率方法来简单证明.

通过随机地选择 {-1, 0, 1} 中的元素构建一个无限长 NAF 序列, 将该无限长序列中的每个元素视为一个独立的随机变量. 计算在该序列中**任意三个连续元素的可能组合**中, 有多少种组合满足 NAF 的稀疏性质.

共有 27 种组合, 符合稀疏性质的有以下八种:

```
1.  (0, 0, 0)
2.  (0, 0, 1)
3.  (0, 0, -1)
4.  (0, 1, 0)
5.  (0, -1, 0)
6.  (1, 0, 0)
7.  (-1, 0, 0)
8.  (1, 0, -1)
9.  (-1, 0, 1)
```

在以上八种组合中, 非零元素 8 个, 总元素 27 个, 故非零位密度为 $\frac{8}{27}\approx 0.296\approx \frac{1}{3}$  
在实际应用中, 由于高阶位的影响 (即正负非零位在高阶位上的分布不完全均匀), 非零位密度略大于 $\frac{8}{27}$, 但仍接近 $\frac{1}{3}$

> 当然可以选择不同长度的组合, 比如 4 个连续元素的组合. 总体来说, 序列非零位密度会逐渐趋近于 $\frac{1}{3}$
