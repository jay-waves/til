## SeLinux

SELinux (Security-Enhanced Linux) 由 NSA 和 RedHat 在 2000 年开发, 在 Linux2.6 中合并到主线 LSM (Linux Security Module) 接口中. 在传统的[自主访问控制 (DAC)](../../netsec/安全模型.md) 基础上, 加入[强制访问控制 (MAC)](../../netsec/安全模型.md).

对于每个对象 (进程, 文件, 端口, 设备), 都有一个安全标签: `user:role:type:level`. 
- user:role:type, 用于 RBAC. 
- level, 用来表示机密等级 (Multi-Level Security), 包括 `s0-s15`.

```
> ls -Zd /srv/myweb
unconfined_u:object_r:httpd_sys_content_t:s0 /srv/myweb
```

注意, 访问控制而不是*资源控制*, 资源控制请使用 cgroup.

## DAC

* subject: 进程, 有凭证: `task->cred->euid`, `task->cred->egid`
* object: 文件, 有属性: `inode->i_uid`, `inode->i_gid`. 访问文件的行为有 rwx.
* policy: 使用 UGO (User/Group/Other) 规则.

例如, 如果进程的 `euid` 和文件 `i_uid` 相同, 那么按照 User 策略来匹配 rwx 权限. 在 `/etc/passwd` 中, 有如下用户信息. 注意其中的口令已经被映射到 `/etc/shadown` 中, 非明文存储. 用户组的详细信息则在 `/etc/group` 中.

```
yjw:x:500:501:yjw:/home/yjw:bin/bash 

用户名:口令:UID:GID:用户名全称:家目录:SHELL
```

内核中只有 `uid`, 用户名则通过查找 `/etc/passwd` 完成.

### UID

uid 有四种表达方式:

|       | 含义            |     |
| ----- | --------------- | --- |
| uid   | real uid        | 进程创建时, 复制父进程的 UID    |
| suid  | saved uid       | 临时升级权限时, 用于缓存原本的 UID    |
| euid  | effective uid   | 实际判断权限时使用的 UID.    |
| fsuid | uid for VFS ops |     |

使用 `sudo/su` 时, 系统并不希望进程始终有 root 权限, 而是需要时再切换权限. 

## Namspaces

namespaces 用于资源隔离, cgroup 用于资源用量限制, 两者通常结合使用.

namespace:
- pid, 隔离进程号
- user, 隔离权限
- mount, 隔离文件系统挂载点
- ipc, 隔离 IPC 
- net, 隔离网络
- uts, 隔离主机名

## CGroup 

cgroup (control groups) 是内核提供的资源控制工具 (限制和统计). 通过 `/sys/fs/cgroup` 下的接口进行控制.

controller:
- cpu/cpuacct, 限制 CPU 使用上限
- memory, 内存配额
- blkio, 块设备 IO 管理, 如限制 swap 和带宽
- pids, 限制进程数
- freezer, 冻结进程
- cpuset, 绑定 cpu 节点