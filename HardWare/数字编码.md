## 如何理解补码?

首先设: $a+b=2^n$, a和b位数相同且为自然数, 并且*n是a和b的位数*.

讨论负数-a的补码表示:
**将b称为-a的补码, a应是正数原码, 正数补码就是原码**

1. Q: 如何理解补码的定义?  
A: 将补码理解为时钟的分针, a相当于正向走了a分钟, b则相当于反向走了(60-a)分钟. 两者分钟数相同, 在模60分钟(1小时)情况下, 时间也相同.

1. Q: 补码怎么和二进制扯上关系?  
A: $2^n$表示的是形如$(1000+)_b$的二进制数喽. 比如$2^3=8=(1000)_b$(以下也多拿该例说明), 3对应的是a和b的位数, 即a和b是三位二进制数比如(111+001), 那么a和b互相称为对方相反数的补码.  
注意, $2^n$比a和b多一位, 这其实导致了开头式子中a和b不能是负的, 否则正数会溢出; 多出的这一位通常在表示中忽略.

## 补码和原码/反码的关系

3. Q: 如何理解公式: `a的反码 + 1 = -a的补码`
- 二进制比较特殊, 存在关系$$(2^n-1)_b  = 111...1111^{n-1}$$. 思考一下反码的机制: *对a的每一位取反以表示-a*, 也就是每一位都异或1:$$a_b \oplus 111111^{n-1}$$, 也就是$(2^n-1)_b$减去a: $$111111^{n-1}-a_b$$, 整理为$$[-a]_{反码} = 2^n-1-[a]_{原码}$$. 这样$$[-a]_{反码}+1 = 2^n-[a]_{原码} = [-a]_{补码}$$

> 需要注意的是都是从**正数a**开始变换, 但是最后得出的是**-a** 的补码和反码. 这一点容易混淆

e.g. 

| 十进制 | 原码 | 反码 | 补码 |
| ------ | ---- | ---- | ---- |
| 5      | 0101 | 0101 | 0101 |
| -5     | 1101 | 1010 | 1011 | 

## 补码表示范围
$[-2^{n-1} ,2^{n-1}-1]$

e.g. 

| 十进制 | 原码 | 补码 | 反码 |
| ------ | ---- | ---- | ---- |
| 3      | 011  | 011  |  011    |
| 2      | 010  | 010  |     010 |
| 1      | 001  | 001  |     001 |
| 0      | 000  | 000  |    000  |
| -0     | 100  | x    |    111  |
| -1     | 101  | 111  |   110   |
| -2     | 110  | 110  |   101   |
| -3     | 111  | 101  |    100  |
| -4     | x    | 100  |   x   |

**原码和反码也是有符号位的, 注意和模数 $2^n$位区分**

## 运算

### 1 原码运算

原码有符号位, 但是其运算存在一些困难性:
- 溢出处理困难, 符号位和溢出难以辨别.
- 减法实现不便, 和加法实现差异较大.

一般将原码转化为补码进行运算. 为了后续证明方便, 我们定义一些表示:  
$[a]_{原码}+[b]_{原码}=[a+b]_{原码}$  
$[a]_{原码}-[b]_{原码}=[a-b]_{原码},\ 保证a>b$  
注意, 负数的原码不应直接参与运算, 即没有$[负数]_{原码}$这样的表示.

### 2 反码运算

运算采用**溢出处理(端到端进位处理)**, 即将反码相加, 溢出位添加到当前结果的最低有效位.

证明:   

若 $a>0,\ b>0$, 则 $[a]_{反码} + [b]_{反码}=[a]_{原码} + [b]_{原码}<2^n-1$, 不会发生溢出.

若 $a<0,\ b>0$, $[a]_{反码} + [b]_{反码}=[a]_{反码}+[b]_{原码}$,  
因为 $[a]_{反码} = 2^n-1-[-a]_{原码},\ a<0$, 所以 $[a]_{反码} + [b]_{反码}=2^n-1-[-a]_{原码}+[b]_{原码}$  
若 $[a]_{反码} + [b]_{反码}> 2^n-1$, 那么也有 $[-a]_{原码}+[b]_{原码}>0$, 所以 $[a]_{反码} + [b]_{反码}-2^n+1=[a+b]_{原码}=[a+b]_{反码}$   
**其中, $[a]_{反码} + [b]_{反码}-2^n+1$ 等效于, 将溢出的位加在末位**.

若 $a<0,\ b<0$, 则 $[a]_{反码} + [b]_{反码}=-[-a]_{原码} - [-b]_{原码}+2^n+2^n-1-1=[a+b]_{反码}+2^n-1$  
所以 $[a]_{反码} + [b]_{反码}-2^n+1=[a+b]_{反码}$.  
**其中, $[a]_{反码} + [b]_{反码}-2^n+1$ 等效于, 将溢出的位加在末位**.

$\blacksquare$

### 3 补码运算

补码运算, 直接相加即可, 溢出直接舍弃.

证明:

因为 $a<0,\ [a]_{补码}=2^n-[a]_{原码}$,   
所以补码运算在模 $2^n$ (保留低n位) 情景下, 含义和一般数值运算等价.

$\blacksquare$