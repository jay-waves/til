
从用户态 (User Mode) 切换到内核态 (Kernel Mode) 的方式:
1. [系统调用](../../Compiler/Runtime%20Library/系统调用.md)
2. 中断

### 中断与异常

现代操作系统的显著特点是: ==中断驱动==. 中断是让内核程序夺回CPU使用权的唯一途径. 中断包括:  
- 外中断: 由硬件引起, 中断信号来自CPU外部. 如:
	- CPU 时钟中断
	- I/O 中断, 键盘鼠标按下
	- 电源掉电
- 内中断 (*异常*): 由软件引起, 信号来自CPU内部. 如:
	- *陷入*, trap, 程序引发, 请求系统调用.
	- *故障*, fault, 指可被内核程序修复的错误. 如缺页故障.
	- *终止*, abort, 致命错误, CPU不会再归还使用权, 而直接终止该程序. 如整除0, 非法使用特权指令.

不同功能的中断由不同的*中断号*, 对应一个*中断处理程序 (Interrupt Service Routine, ISR)*. 两者之间的映射关系, 由内核数据结构*中断向量表 (Interrupt Vector Table)*记录. 由于中断号很有限, 所以系统调用和中断号不是一一对应的, 而是由另一个值决定系统调用号 (如 x86 系统中的 `eax` 寄存器). 

#### I/O操作 中断处理

![|400](../../attach/Pasted%20image%2020230618230129.png)

1. CPU通过I/O指令通知I/O设备控制器.
2. 控制器操作具体设备执行I/O操作, CPU执行其他指令.
3. I/O完成后, 控制器触发中断, 通知CPU
4. CPU根据中断号查询**中断向量表, 执行中断处理程序**.

#### 执行系统调用

系统调用过程详见 [系统调用](../../Compiler/Runtime%20Library/系统调用.md), 常见类 Unix 系统的系统调用列表见 [Appendix/UnixSystemCall](../../appx/unix%20system%20call.md).

![|500](../../attach/Pasted%20image%2020230618231116.png)

![400](../../attach/Pasted%20image%2020230618231521.png)
