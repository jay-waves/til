
linux 内存管理的主要作用是隔离多个进程的内存区域, 实现虚拟内存到实际物理内存的转换. 包括 物理内存管理 / 虚拟内存管理 / 页面分配与回收 / 用户空间接口 四个层次.



## 物理内存管理

分配和回收物理 *页面 (Page Frame)* 的算法称为 *伙伴系统 (Buddy System)*, 通过分裂和合并来减少物理页面空隙.

在 NUMA (非均匀内存访问) 系统中, 内存不按页分配, 而是按 *节点 (Node)* 分配, 节点再分配为 *区域 (Zone)*. 比如内存 `ZONE_MEM`, 低端设备 `ZONE_DMA`

## 页面分配与回收

页面分配器 (Allocator) 分配 / 缓存 / 回收 *内存页 (Page)*. 

在页基础上, 使用 Slab Allocator 分配更小块内存, 用于减少碎片. (仅支持内核对象)

## 虚拟内存管理

数据结构是多级 *页表 (Page Table)*, 实现虚拟地址到物理地址的映射. 常见算法是: 按需分页, 页面置换, 写时复制, 反向映射.

## 用户空间接口

linux 提供系统调用, 系统调用一般遵循 POSIX 标准.
- `mmap()` 映射文件或匿名内存
- `brk()` 扩展堆
- `mprotect()` 修改内存权限

用 *虚拟内存区域 (VMA, Virtual Memory Area) 结构* 管理进程的各个内存段 (代码段, 数据段, 堆栈等, 严格意义上是 *节 (Seciton)*). VMA 结构用[红黑树](../../Algorithm/树/red-black%20tree.md)管理.

