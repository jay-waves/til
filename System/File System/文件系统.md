> https://blog.csdn.net/hguisu/article/details/7401963

linux 支持很多文件系统:
- 磁盘文件系统: 如 ext, xfs, 将数据存储于磁盘.
- 内存文件系统: 存储与内存, 常用于共享内核数据, 如 `/proc`, `/sys`
- 网络文件系统: 如 nfs, smb

| FS         | 描述                                                    |
| ---------- | ------------------------------------------------------- |
| MINIX    | linux 第一代操作系统, 性能欠佳. 文件名最大 `14char`, 文件体积最大 `64MB`                                                       |
| Ext - Ext4 | extended file system. linux 原生文件系统                                      |
| swap       | linux 用于交换分区 (类似 windows 的虚拟内存) 的 VFS     |
| NFS        | Network File System, 用于实现主机间文件挂载共享         |
| iso9660    | 光盘标准文件系统                                        |
| [FAT](fat.md)        | windows 下文件系统. vFAT 也叫 FAT32.                    |
| NTFS       | windows NT 文件系统, 更安全高效, linux 默认无法识别     |
| [proc](proc.md)       | linux 用于记录系统调试信息的 VFS, 基于内存              |
| ufs        | Sun 公司的 Solaris, SunOS 操作系统所用文件系统          |
| sysfs      | linux 用于管理内存存储的 VFS, 基于内存                  |
| tmpfs      | linux 用于管理临时文件的 VFS, 基于内存. 可用 swap 替代. |
| shm        | linux 用于共享内存的 VFS                                |
| msdos      |                                                         |
| smb        |                                                         |
| sysv       |                                                         |

linux 每个文件有两个结构:
- 索引节点, `inode`, 记录文件元信息, 是文件的唯一标识. 会占用磁盘空间. 目录也是一种文件, 用于保存子目录和文件信息.
- 目录项 `dentry`, 记录文件名, `inode` 指针以及层级关系(目录结构), 缓存于内存.

索引节点可以被多个目录项引用, 即一个文件实体有多个别名. 如硬链接.

磁盘格式化时, 会划分为三个存储区域, 分别为:
- **超级块**, 存储文件系统信息, 如块数和空闲数. 挂载文件系统时被载入内存.
- 索引节点区, 存储索引节点. 当文件被访问时载入内存.
- 数据块区, 存储文件数据.

```c

/* file, dir, socket, block device, pipeline... */
struct file
	mode_t f_mode;
	loff_t f_pos;
	unsigned short f_flags;
	unsigned short f_count;
	unsigned long f_reada, f_ramax, f_raend, f_ralen, frawin;
	struct file *f_next, *f_prev;
	int f_owner; /* pid or -pgrp where SIGIO shoud be sent */
	
	struct inode *f_inode;
	struct file_operations *f_op;
	unsigned long f_version;
};

struct files_struct {
	int count;
	fd_set close_on_exec;
	fs_set open_fds;
	struct file *fd[NR_OPEN];.
};

struct fs_struct {
	int count;
	unsigned short umask;
	struct inode *root, *pwd;
};
```

gendisk
```c
struct hd_struct {
    long start_sect;
    long nr_sects;
};

struct gendisk {
    int major;               /* major number of driver */
    const char *major_name;  /* name of major driver */
    int minor_shift;         /* number of times minor is shifted to
                                get real minor */
    int max_p;               /* maximum partitions per device */
    int max_nr;              /* maximum number of real devices */

    void (*init)(struct gendisk *); 
                             /* Initialization called before we 
                                do our thing */
    struct hd_struct *part;  /* partition table */
    int *sizes;              /* device size in blocks, copied to 
                                blk_size[] */
    int nr_real;             /* number of real devices */

    void *real_devices;      /* internal use */
    struct gendisk *next;
};
```

```c
struct mm_struct {
    struct vm_area_struct *mmap;  // 虚拟内存区域
    struct rb_root mm_rb;         // 红黑树根，用于快速查找VMAs
    pgd_t *pgd;                   // 页全局目录
    // 更多字段...
};

```

虚拟内存:
```c
struct vm_area_struct {
    struct mm_struct *vm_mm;      // 指向内存描述符
    unsigned long vm_start;       // 区域开始地址
    unsigned long vm_end;         // 区域结束地址
    struct vm_area_struct *vm_next;  // 链接到下一个区域
    pgprot_t vm_page_prot;        // 页面保护属性
    // 更多字段...
};
```

