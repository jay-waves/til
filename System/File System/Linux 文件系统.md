> https://blog.csdn.net/hguisu/article/details/7401963

linux 支持很多文件系统:
- 磁盘文件系统: 如 ext, xfs, 将数据存储于磁盘.
- 内存文件系统: 存储与内存, 常用于共享内核数据, 如 `/proc`, `/sys`
- 网络文件系统: 如 nfs, smb

| FS              | 描述                                                                     |
| --------------- | ------------------------------------------------------------------------ |
| MINIX           | linux 第一代操作系统, 性能欠佳. 文件名最大 `14char`, 文件体积最大 `64MB` |
| Ext - [Ext4](ext4.md)      | extended file system. linux 原生文件系统                                 |
| swap            | linux 用于交换分区 (类似 windows 的虚拟内存) 的 VFS                      |
| NFS             | Network File System, 用于实现主机间文件挂载共享                          |
| iso9660         | 光盘标准文件系统                                                         |
| [FAT](fat.md)   | windows 下文件系统. vFAT 也叫 FAT32.                                     |
| NTFS            | windows NT 文件系统, 更安全高效, linux 默认驱动无法识别. 无文件大小限制, 支持高级安全功能, 支持稀疏文件和动态扩展体积                      |
| [linux proc](../SSS/linux%20proc.md) | linux 用于记录系统调试信息的 VFS, 基于内存                               |
| ufs             | Sun 公司的 Solaris, SunOS 操作系统所用文件系统                           |
| sysfs           | linux 用于管理内存存储的 VFS, 基于内存                                   |
| tmpfs           | linux 用于管理临时文件的 VFS, 基于内存. 可用 swap 替代.                  |
| shm             | linux 用于共享内存的 VFS                                                 |
| msdos           |                                                                          |
| smb             |                                                                          |
| sysv            |                                                                          |
| exFAT           | Extedned File Allocation Table, 微软开发, 作为 FAT32 改进版本. 跨平台兼容性较好, 用于 U 盘或外部硬盘. 文件最大 16EB, 但没有自带加密功能和稀疏文件支持.                                                                         |

linux 每个文件有两个结构:
- 索引节点 index node, `inode`, 记录文件元信息, **是文件的唯一标识**. 会占用磁盘空间. 目录也是一种文件, 用于保存子目录和文件信息.
- 目录项 directory enty, `dentry`, 记录文件名, 索引节点指针以及层级关系(目录结构). 内核将已读取的目录/文件索引缓存在内存中, 称为目录项.

索引节点可以被多个目录项引用, 即一个文件实体可以有多个别名. 如硬链接.

磁盘格式化时, 会划分为三个存储区域, 分别为:
- **超级块**, 存储文件系统信息, 如块数和空闲数. 挂载文件系统时被载入内存.
- 索引节点区, 存储索引节点. 当文件被访问时载入内存.
- 数据块区, 存储文件数据.

用户一般以字节为单位处理文件数据, 而操作系统以数据块为单位处理. 文件系统负责屏蔽这种差异.


## 空闲空间管理

保存新数据块时, 需要在磁盘上挑选一个未被使用的数据块. 

*空闲表法*, 用一张表存储磁盘中空闲区域. 当有大量碎片化空闲区时, 空闲表体积大, 效率低. 与显式表对应的, 还有*隐式链表法*, 即每个块都存储一个链表头, 将空闲块链接为一个链表. 空闲链表不支持随机访问, 也不适合大型文件系统.

```c
struct {
	int start; /* 空闲区域起始块号 */
	int len;   /* 空闲区域长度 */
} free_table[];
```


*位图法*, 利用二进制的一位来标识磁盘中一个块的使用情况, 0 标识盘块空闲. linux 使用该方法对 inode 空闲块与磁盘空闲块进行管理[^1].

```c
11111001111111100100101101101011000...
```

[^1]:  见 [linux bitmap](../../Algorithm/内核/bitmap.md)页缓存. 当不指定 `O_DIRECT` 标志时, 默认非直接 I/O, 读写操作和内核缓存交互, 由内核决定何时与磁盘交互.

