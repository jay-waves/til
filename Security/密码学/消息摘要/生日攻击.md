
攻击[密码学杂凑函数](ReadMe.md)的目标是: 伪造消息, 使其与原消息杂凑值相同

对于 $n$ 比特长输出的杂凑函数, 其可能输出空间大小 $N=2^{n}$. 由于随机性, .... 概率为 $\frac{1}{N}$.

## 生日悖论

**k 个人至少有两个人生日相同的概率大于 $0.5$ 时, k 至少需要多大?**

k 个人中任意两个人生日都不相同的概率 $\large p_{1}=\frac{A^{k}_{365}}{365^{k}}=\frac{365!}{(365-k)!\times 365^{k}}$, 所以有两人相同的概率 $p=1-p_{1}$  
当 $k=23$ 时, $p=0.5073$, 人数如此之少, 和直觉相违背, 所以称为生日*悖论*.

因此, 若散列函数 H 有 $2^m$ 个可能输出, 要让 H 的*k 个随即输入*中至少有两个输出相同的概率大于 0.5, 需 $k\approx \sqrt{ 2^m }$

## 第一类生日攻击

原像 (或第二类原像) 攻击, 即第一类生日攻击. 即给定 Hash 值 $h$, 求输入值 $x$.  

假定 Hash 函数有 $n$ 个可能输出, 尝试 $k$ 个输入, 结果为 $h$ 可能性为: $p=1-\left( 1-\frac{1}{n} \right)^{k}\approx \frac{k}{n}$  
对于输出 $m$ 比特长, 输出可能 $n=2^{m}$, 要让 $p\geq 0.5$, 需要 $k\geq 2^{m-1}$

因此对于输出 $m$ 比特长的哈希函数, 生日攻击时间复杂度为 $\mathcal{O}(2^{\frac{m}{2}})$.

## 第二类生日攻击

定义: Birthday Attack, 找到哈希函数 $H$ 的任意两个*输出相同*的输入值, 是碰撞攻击的一种.

$m$ 与 R 个 $M$ 随机变形 不碰撞概率为: $p_{1}=(1-\frac{1}{2^{n}})^R$  
$m$ 也有 r 个变形, 所以 不碰撞概率为: $p_{2}=\left( 1-\frac{1}{2^{n}} \right)^{Rr}=e^{\ln(1-\frac{1}{2^{n}})*Rr}\approx e^{-\frac{rR}{2^{n}}}$  
碰撞的概率为: $p=1-p_{2}\approx 1-e^{-\frac{rR}{2^{n}}}$  
当 $r=R=2^{\frac{n}{2}}$ 时, $p=1-e^{-1}\approx 0.63$

#### 第二类生日攻击步骤

$A\to B:\ M\mid\mid Sig_{A}(\ Hash(M)\ )$, 先对消息 M 做 Hash, 然后签名  
$C:\ M\Rightarrow\{M_{1}, M_{2}, \dots, M_{2^{\frac{m}{2}}}\}$, 生成 M 的 $2^{\frac{m}{2}}$ 个变体  
$C:\ M'\Rightarrow \{M'_{1}, M'_{2}, \dots, M_{2^{\frac{m}{2}}}\}$, 伪造消息并扩展直到找到 $Hash(M_{i})=Hash(M'_{j})$  
$C\to A:\ M_{i}$, 由于 $M_{i}$ 意义类似于 $M$, A 误判并对其签名  
$A\to C:\ Sig_{A}(\ Hash(M_{i})\ )$, 可以当作 $M'_{j}$ 的签名  
$C\to X:\ M'_{j}\mid\mid Sig_{A}(\ Hash(M_{i})\ )$  

扩展 $M$ 变体, 而且不改变语义的方法较多, 常见有插入 `space-backspace` 对和一些不可见字符, 或者改变句式结构.

## 中点交会攻击 

[Meet in the middle](../分组密码/Feistel-结构/EDE.md), ...
