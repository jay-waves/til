
攻击[密码学杂凑函数](消息摘要.md)的目标是: 伪造消息, 使其与原消息杂凑值相同

对于 $n$ 比特长输出的杂凑函数, 其可能输出空间大小 $N=2^{n}$. 由于哈希函数保证伪随机性, 出现每种输出的概率可视为为 $\frac{1}{N}$.

## 生日悖论

**k 个人至少有两个人生日相同的概率大于 $0.5$ 时, k 至少需要多大?**

k 个人中任意两个人生日都不相同的概率 $\large p_{1}=\frac{A^{k}_{365}}{365^{k}}=\frac{365!}{(365-k)!\times 365^{k}}$, 所以有两人相同的概率 $p=1-p_{1}$  

当 $k=23$ 时, $p=0.5073$. 也就是说, 只需 23 个人, 就有超一半的概率出现相同生日的两个人. 这和直觉相违背, 所以称为生日*悖论*. 

针对消息摘要的各类碰撞攻击受该悖论启发.

## 第一类生日攻击

第二类原像攻击, 第一类生日攻击 (Birthday Attack), 针对哈希算法的弱碰撞抗性. 即给定哈希函数输出值 $h$, 求输入值 $x$.  

假定哈希函数有 $N$ 个可能输出, 尝试 $k$ 个输入, 结果为 $h$ 可能性为: $p=1-\left( 1-\frac{1}{N} \right)^{k}\approx \frac{k}{N}$  

设输出可能性有 $N=2^{n}$ 种, 要让 $p\geq 0.5$, 需要尝试次数 $k\geq 2^{n-1}$.

因此对于输出 $n$ 比特长的哈希函数, 生日攻击时间复杂度为 ${} \mathcal{O}(2^{n-1}) {}$.

## 第二类生日攻击

第二类生日攻击, 针对哈希算法的强碰撞抗性. 找到哈希函数 $H$ 的任意两个*输出相同*的输入值, 是碰撞攻击的一种.

$m$ 与 $R$ 个 $M$ 随机变形 不碰撞概率为: $$p_{1}=(1-\frac{1}{N})^R$$

$m$ 也有 $r$ 个随机变形, 所以 不碰撞概率为: $$p_{2}=\left( 1-\frac{1}{N} \right)^{Rr}=e^{\ln(1-\frac{1}{N})*Rr}\approx e^{-\frac{rR}{N}}$$  

碰撞的概率为: $p=1-p_{2}\approx 1-e^{-\frac{rR}{N}}$  

当 $r=R={\sqrt{ N }}$ 时, $p=1-e^{-1}\approx 0.63$

### 针对带消息签名的伪造攻击.

对于[带消息附录的签名形式](../公钥密码/数字签名/数字签名.md), 签名为 $\set{\mathrm{hash}(M)}_{sk}\Vert M$. 如果能伪造一个 $M'$, 使 $\mathrm{hash}(M)=\mathrm{hash}(M')$, 就能伪造出新签名 $\set{\mathrm{hash}(M')}_{sk}\Vert M'$, 但名义上签发者 ($sk$ 拥有者) 并不知情.

上述碰撞攻击中, $M$ 和 $m$ 的随机变形, 可以通过插入 `\t`, `\s` 等不可见字符实现, 这样同时也不改变语义.

## 中点交会攻击 

...