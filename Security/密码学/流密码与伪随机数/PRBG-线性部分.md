## LFSR

常见 PRNG 驱动子系统为 Linear Feedback Shift Register. 换言之, LFSR是序列密码常用乱源, 用递推关系产生**周期长, 线性复杂度高, 统计特性好**的乱数序列. LFSR是构造流密码的基础, 它负责更新系统内部状态, 并输出中间结果交付 [PRNG 非线性部分](PRBG-非线性部分.md).

LFSR由其反馈逻辑函数定义: $x_{n+1}=f(x_{1},\ x_{2},\ \dots,\ x_{n})=c_{1}x_{n}+c_{2}x_{n-1}+\dots+c_{n}x_{1}$, 实际上是一布尔函数, 其中$c_{i}\in \mathbb{GF(2)}$, "$+$" 定义为 "$\oplus$". $f$ 决定了 $x_{i}$ 的递推式; 其内部状态 $(x_{n},\ x_{n-1},\dots,x_{n-k})$ 则移位迭代, 左侧接收 $x_{n+1}$, 右侧输出 $x_{n-k-1}$.

![|450](../../../attach/Pasted%20image%2020230609234108.png)

在 $\mathbb{GF}(2^{n})$ 上定义 LFSR 的**特征 (级连/生成) 多项式**, 其中多项式级数 k 代表 LFSR 内部状态数: $$f(x_{1},x_{2},\dots, x_{n})=1+c_{1}x+c_{2}x^{2}+\dots+c_{k}x^{k}=\sum^{k}_{i=1}c_{i}x^{i}$$
例子:
![|500](../../../attach/Pasted%20image%2020230609220658.png)

### LFSR 输出序列

周期最长的 LFSR 序列称为 **m 序列**, 其特征多项式 $f$ 阶数为 n, 可以生成**一个周期为 $2^{n}-1$ 的序列和一个全零序列,** 这是因为零状态 (所有内部状态皆为0) 的下一个状态也是零状态, 任何非零状态的下一个状态均不是零状态. 从离散数学角度, 该反馈逻辑函数能生成完整*真值表*, 并且其状态转移图是一个圈.

同一个 LFSR 序列可能有多个生成特征多项式 $f$, 其中次数最小的称为**极小多项式**, 实质是 $GF(2^{n})$ 上一个本原多项式.

***

### A5 流密码算法

> 参考 [A5 和 RC4 算法介绍](https://zhuanlan.zhihu.com/p/367447046)

A5 算法由 **3 个 m 序列 LFSR 构成**, **级数分别为19, 22, 23**. 其特征多项式分别为: 

-   LFSR1: $g_1(x)=x^{19}+x^{18}+x^{17}+x^{14}+1$
-   LFSR2: $g_2(x)=x^{22}+x^{21}+x^{17}+x^{13}+1$
-   LFSR3: $g_3(x)=x^{23}+x^{22}+x^{19}+x^{18}+1$

***

