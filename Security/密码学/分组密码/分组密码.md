### 为什么密钥长度应不小于分组长度?

香农信息论证明要实现**无条件安全**, 密钥长度至少与明文长度相同, 并且是完全随机和只使用一次的 (即 One-Time Pad). 证明主要有以下三点:
1. 所有明文等概率: 对于任何密文, 任何明文出现概率应是相同的.
2. 密钥的随机性和唯一性: 为了达到1条件, 密钥必须是唯一的和随机的. 这样, 即使同一明文, 产生的密文也会因使用不同密钥而不同.
3. 密钥数量需求: 若明文有 $M$ 种可能, 为了确保每种明文都能等概率映射到密文上 (即实现一一映射), 至少需要 $M$ 种不同密钥. 即, 明文和密钥数量至少一样多 ($M=2^{n}$), 因此密钥的长度应为 $n$.

### 为什么要引入分组密码？

先看映射的性质：随位数增长, 映射 (非线性变换) 个数可以呈指数增长。  
$n\text{ bits }\rightarrow 2^n!$ 种变换, $n$ 代表了一个分组的长度, $2^n$ 代表了明文和密文空间的大小 (元素个数), 2是二进制bit的底 (如果是字母, 底为26)

古典密码, 分组 $n=1$, 所以**不抗穷举攻击**. 当然传统密码加密的是字母, 而不是数字, "分组为1" 指单个字母替换, **不抗一阶统计规律分析** (字母频率). 因此分组过小, 并不安全.

但若分组 $n$ 过大, 整个密钥空间会指数级膨胀, 效率下降很快. 比如**理想分组密码**会要求支持所有可能的可逆映射, 密钥存储空间膨胀为 $n\times 2^{n}$, 并不现实.

解决办法就是**将一个大分组拆分为数个较小分组, 将密钥长度和分组长度解绑.**


## 分组密码定义

分组密码 (block cipher): $E\ \{0, 1\}^{k}\times \{0, 1\}^{n}\to \{0, 1\}^{n}$

分组密码引入了**扩散和混淆**机制, 将明文分为等长块进行变换. 分组密码和流密码的核心区别是: 分组密码以组为单位进行加密, 流密码逐比特 (逐单位) 进行加密, 因而失去了*扩散性*.

分组密码加密速度较快, 但是无法解决**身份认证**以及**密钥管理**问题.

## 安全需求

- 混淆 (confusion): 使密钥和明文之间的关系变得复杂, 通常和非线性变换相关.
- 扩散 (diffusion): 使密文和明文之间关系变得复杂, 将明文的统计结构分散, 通常和线性变换相关. 扩散类似于**雪崩效应**.

> 关于混淆和扩散区别, 有篇介绍[Confusion and Diffusion in AES](https://crypto.stackexchange.com/questions/51219/confusion-and-diffusion-in-the-aes-functions)

### 潜在攻击手段

攻击者通常只具有概率多项式时间计算能力, 称为 Probabilistic Polynomial Time, PPT 攻击者. 密码协议能抵抗 PPT 攻击者, 就称为**密码学安全的**; 如果额外考虑了有无限计算能力的攻击者, 就称为**信息论安全**的. [^1]

[^1]: 详见[可证明安全](../附录/可证明安全/Provable%20Security.md)相关内容.

针对密码协议的攻击, 从攻击者所掌握信息分类, 有:
1. 唯密文攻击: 只知道密文.
2. 已知明文: 知道一些明密文对.
3. 选择明文: 掌握 Enc(,k), 可以选择明文, 并得到其对应密文.
4. 选择密文: 掌握 Dec(,k), 可以选择密文, 并得到对应明文.
5. 选择文本: 选择明文 + 选择密文

## 设计方法:

分组密码设计都需要将单轮加密步骤重复多轮, 每轮都需要明文(或中间结果)和密钥的同时参与, 所以每轮需要不同的子密钥.  所以分组密钥组成结构一般有:
1. 多轮子密钥派生算法
2. 多轮加密网络结构
3. 扩散/混淆效果组件

加密网络结构有:
- [Feistel](Feistel-结构/Feistel.md)
- [SP 网络](SP-结构/代换置换网络.md)

为了适应远超**分组长度**的明文加密需求, 还衍生出多种加密单元[链接模式](链接模式.md)