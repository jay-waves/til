---
revised: 24-11-29
---

### 为什么密钥长度应不小于分组长度?

香农信息论证明要实现**无条件安全**, 密钥长度至少与明文长度相同, 并且是完全随机和只使用一次的 (即 One-Time Pad). 证明[^2]主要有以下三点:
1. 对于任何密文 $c$, 任何明文 $m\in\mathcal{M}$ 出现的概率应该是相同的.
2. 密钥必须有随机性和单射性, 对于同一密钥 $k$, 不能将不同明文 $m_{1}\neq m_{2}$ 加密为同一密文, 即 $Enc_{k}(m_{1})\neq Enc_{k}(m_{2})$.
3. 对于同一密文 $c$, 为了确保任意明文 $m\in\mathcal{M}$, 都等概率映射到 $c$ 上, 至少需要 $|\mathcal{M}|$ 种不同的密钥. 因此明文和密钥数量至少一样多, 即 $|\mathcal{K}|\geq|\mathcal{M}|$.

[^2]: 这里描述了[可证明安全](../可证明安全.md)中对完美加密的证明思路.

### 为什么要引入分组密码？

密码的作用是将一串字符串 $1^{n}$ 替换为另一串不相关字符串. 现代对称密码通常保证明文和密文的等长性, 主要有三点原因, 第一是避免因长度变化导致的额外信息泄露, 第二是避免引入额外填充步骤导致安全风险, 第三是长度一致性保证了加密对上层其他步骤是透明的, 避免一致性导致的处理复杂性. 

对于替换 $1^{n}\to 1^n$, 假设字符串基底为 $2$, 单个字符串的替换结果可能有 $2^{n}$ 种情况. 考虑一个密钥 $k$ 代表的映射 $Enc_{k}(\cdot)$, 总将明文空间 $|\mathcal{M}|=2^{n}$ 个明文, 一一映射到密文空间 $|\mathcal{C}|=2^{n}$ 个密文. 这种映射共有 $2^{n}!$ 个.

当长度 $n$ 较小时, 替换种类较少, 易被穷举攻击 (如针对凯撒密码的字母频率攻击). $n$ 较大时, 密钥存储成本会上升, 此时可以用密钥生成器对短密钥进行迭代和扩展, 然后将字符串作为一个整体加密, 类似流密码; 也可以将字符串拆分为中等长度的等长分组, 每个分组独立加密.

## 分组密码定义

分组密码 (block cipher): $E:\ \  1^{k}\times 1^{n}\to 1^{n}$

分组密码引入了**扩散和混淆**安全需求:

- 混淆 (confusion): 使密钥和密文之间的关系变得复杂, 使敌手通过密文的统计特性无法推测密文信息. 通常和非线性变换相关.
- 扩散 (diffusion)[^3]: 使密文和明文之间关系变得复杂, 让明文中每一位尽可能影响密文的更多位, 从而将明文的统计结构打散. 通常和线性变换相关. 类似*雪崩效应*.

[^3]: 关于混淆和扩散区别, 可参考 [Confusion and Diffusion in AES](https://crypto.stackexchange.com/questions/51219/confusion-and-diffusion-in-the-aes-functions)

为了实现良好的扩散和混淆效果, 分组密码多采用多轮迭代加密, 组件包括*多轮子密钥的派生算法, 多轮加密网络结构, 增强扩散和混淆效果的独立结构*, 经典加密结构有:
- [Feistel](Feistel%20结构/Feistel.md)
- [SP Network](SP%20结构/代换置换网络.md)


分组密码将长明文划分为等长分组进行加密, 每组独立使用加密算法. 在不同组之间引入迭代关系, 可以增强加密效果, 详见 [链接模式](链接模式.md).

分组密码的性能通常被认为快于[公钥密码](../公钥密码/公钥密码.md), 慢于[流密码](../流密码与伪随机数/流密码与伪随机数.md).

## 潜在攻击手段

攻击者通常只具有概率多项式时间计算能力, 称为 Probabilistic Polynomial Time, PPT 攻击者. 密码协议能抵抗 PPT 攻击者, 就称为**密码学安全的**; 如果额外考虑了有无限计算能力的攻击者, 就称为**信息论安全**的. [^1]

[^1]: 此部分的详细定义可见[可证明安全](../可证明安全.md)

针对对称密码中使用同一密钥加密的一些密文, 攻击者想要破译其明文 (大幅缩小可能的明文空间), 根据攻击者能力不同, 如下几种攻击形式:
1. 唯密文攻击: 只知道孤立密文, 也称为是窃听安全的, 是最基础的保密性.
2. 已知明文 (KPA): 知道一些明密文对.
3. 选择明文 (CPA): 可以选择某些明文进行加密, 并得到对应密文. 显然公钥密码必须有 CPA 安全性.
4. 选择密文 (CCA): 可以选择某些密文进行解密, 并得到对应明文. 但不能直接请求要破译的密文 (目标密文).
	- CCA1: 一次性选择构造好密文, 发送给解密谕示机 (某种解密接口). 此后不能再访问解密谕示机.
	- CCA2 (自适应选择密文攻击, Adaptive CCA): 构造好密文, 发送给解密谕示机. 可以根据解密结果, 进一步构造密文, 并发送给解密谕示机.
1. 选择文本: 选择明文 + 选择密文

> 选择密文攻击 (CPA) 经典攻击案例: 二战中, 美军破译了日本的部分密码, 其中某个 "AF" 代号指向了某个日军攻击目标. 美军不能推断 "AF" 具体指哪个地区, 于是故意散播信息, 称 "中途岛上的海水净化装置故障导致岛上缺水", 不久在日军密电中同样截获了 "AF" 代号的信息, 从而确认日军攻击目标就是中途岛.


## 常见分组密码算法

- [DES](Feistel%20结构/DES.md)
- [AES, Nijndael](SP%20结构/AES.md)
- Serpent. Ross Anderson etc. 1998. SPN 结构.
- Twofish. Bruce Schneier. 1998. 采用 Feistel 结构, 添加了 MDS 矩阵变换
- Camelia. Jepanese NTT Inc. 2000. 采用 Feistel 结构, 添加了 FL/FL-1 逆变换
- Kuznyechik (草地鹞). Russian FSB. 2015. 采用 SPN 网络
- [SM4](Feistel%20结构/SM4.md). Chinese SCA. 2012

Twofish, Serpent 都是 NIST AES 的候选算法之一. Camelia, SM4, Kuznyechik 则有较浓政治色彩. 