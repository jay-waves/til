## AKA 协议

传统计算机网络接入互联网的方式是有线接入, 运营商分配固定 IP; [无线网络通信](../../../../HardWare/无线通信技术.md)则是手机与基站在空口无线接入, 动态分配 IP. 由于手机移动的特性, 每次接入时, 需要对用户身份 (SIM 卡身份)进行认证, 认证成功后才分配资源. *AKA (Authentication and Key Agreement)*  协议就是 3G/4G/5G 网络中完成用户认证的协议.

### 2G-GSM AKA

![|700](../../../../attach/无线通信网络_2G-GSM-AKA协议.avif)

GSM 安全性缺陷:
- 主密钥 `K` 固定存储在 SIM 卡中, 有复制 SIM 卡风险. 截获 `RAND` 和 `SRES` 后, 由于 A3 算法的输出长度较短以及设计缺陷, 攻击者容易破译出 `K`
- 首次开机时泄露 IMSI 信息.
- 基站对用户实施单向认证, 用户并不认证网络, 存在伪基站.
- 骨干网数据传输无加密, 即基站与基站之间没有加密措施, 当用户切换蜂窝小区时, 密码可能被泄露.
- 无数据完整性验证机制
- `K` 直接参与认证和加密, 有泄露主密钥风险, 缺少层次化密钥保护. 

CDMA 使用防篡改的 UMI (UserIdentity Module) 卡替代了 GSM 的 SIM 卡. 其保密和认证结构与 GSM 大致相同.

### 3G-WCDMA AKA

![|1000](../../../../attach/无线通信网络_3G_AKA协议.avif)

> f6~f10 在哪? SQN 是每次会话递增的, 

3G 网络的新增安全机制
- 用户网络间双向认证
- (用户网络间使用会话密钥, 并保证会话密钥的新鲜性)
- 数据完整性验证机制

3G 网络新增的安全缺陷:
- 安全算法 $f_{1}\sim f_{10}$ 过多
- 完整性验证密钥 (IK) 和加密密钥 (CK) 直接在骨干网传输, 并且认证向量较长, 存在窃听风险.
- 仍缺少层次化密钥保护, $IK,CK$ 都由主密钥 $K$ 直接派生.

### 4G-LTE EPS-AKA

为了保证一定的兼容性, 4G 网络沿用了 3G 网络中 CK 和 IK 的生成方式, 在其基础上引入层次化密钥管理. 在 4G 网络中, $CK$ 和 $IK$ 不需要每次通信重新生成, 而是可以在设备和核心网之间较长期持有, 减少了完整认证操作频率. $CK$ 和 $IK$ 派生临时密钥 $K_{ASME}$ 用于每次具体会话.

4G 网络的新增安全机制
- 实现了层次化密钥管理, $CK,IK$ 派生接入网络的上层密钥 $K_{ASME}$, 派生更多临时子密钥:
	- $K_{NASen}$, 保护空口信令的保密性.
	- $K_{NASint}$, 保护空口信令的完整性.
- 隐藏了中间密钥 $CK$, $IK$, 核心网 (HSS/AuC) 和用户设备 (UE) 可直接将它们用于认证.
