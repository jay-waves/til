
密码体系有两个准则:
1. Kerchhoff 准则: 密码系统的安全性应依赖于密钥的保密性, 而非算法的隐秘性.
2. Dolev Yao 准则: 安全协议本身应该与其所具体采用的密码技术分开, 在假定密码技术完善的基础上分析安全协议本身的安全性/正确性/冗余性.

> 思考, 如何不符合 Kerchhoff 准则, 直接将密钥嵌入到算法之中, 而不是独立出来作为输入, 会有什么后果?

## 安全协议标准

*协议*: 两个以上参与方, 依次执行, 完成某种任务.

*仲裁协议*中, 可信第三方参与协议执行. *裁决协议*中, 可信第三方不直接参与协议执行; 但当协议产生纠纷时, 双方会向可信第三方 (此时称为裁决方) 提交证据, 由裁决方提供仲裁. 裁决协议中, 裁决者通过双方证据来判断是否存在欺骗, 但并不能直接杜绝欺骗. *自执行协议*中, 协议本身就保证公平性, 如果任意一方欺骗, 会被协议检测出, 立即停止执行. 自执行协议常基于密码学技术设计.

安全协议与一般通信协议的区别是: 有恶意参与者. 安全协议除了协议正确性和效率, 还额外兼顾**安全需求**和**鲁棒性**.

安全协议模型组成部分:  
- 参与者类型: 参与者, 攻击者, 可信第三方 (Trusted Third Party), 仲裁者 (Arbiter)
- 参与者间网络连接情况: 见 [通信技术](../../../Information/通信技术/通信技术.md)
- 协议参与者的诚实程度: 
	- 诚实参与者
	- 半诚实参与者: 按协议要求执行, 但监听消息
	- 恶意攻击者: 不仅监听, 还恶意设计执行方式, 控制其他参与方的行为. 也称为 Byzantine 攻击者.
- 协议攻击者的能力: 拥有无限计算能力的攻击者, 拥有概率多项式时间计算能力的攻击者
- 协议参与者之间的信道类型: 安全信道, 认证信道, 未认证信道.

### 功能分类

基础协议功能分类:
1. [密钥建立协议](密钥分发与管理.md), Key Establishment/Exchange Protocol.
	1. 密钥传输协议
	2. 密钥协商协议
1. [认证协议](认证协议.md), Authentication Protocol. 
1. 认证的密钥建立协议, 即与已被认证的实体间建立共享秘密.
	1. [基于单钥的认证密钥协商](认证的密钥协商协议/基于单钥的认证密钥协商.md)
	2. [基于公钥的认证密钥协商](认证的密钥协商协议/基于公钥的认证密钥协商.md)

常见的认证协议有:
- Kerberos, 基于单钥
- [SAML](../../../Network/ApplicationL4/Auth/SAML.md)
- [OAuth](../../../Network/ApplicationL4/Auth/OAuth.md), 开放认证协议.

常见的密钥协议协议有:
- [DiffieHellman](../公钥密码/DiffieHellman.md)
- [RSA 密钥交换](../公钥密码/RSA/RSA.md)
- [ECDH](../公钥密码/ECC/ECC.md)
- IKE, 用于 [IPSec](Network/VPN/IPSec.md)

其他安全协议功能: 
1. [数字签名, 通信加密, 完整性保护协议](混合加密.md). 提供最基础安全目标, 不再赘述.
2. 分布式系统安全协议, 用于区块链和分布式系统达成信任和共识.
	- BFT, 拜占庭容错协议.
	- 区块链共识协议, 如 PoW (工作量证明), PoS (权益证明)
	- 时间同步安全协议 (Time Synchronization). 如 NTPsec, PTP.
2. 电子支付和电子商务安全协议, 保证在线支付和数字货币的安全性.
	- SET (Secure Eletronic Transaction), 用于信用卡
	- 3D Secure.
1. 匿名路由协议. 保护流量隐私.
	- [Tor, 洋葱路由协议](Network/VPN/VPN.md)
	- I2P
	- Mixnets, 混合网络
1. 隐私计算协议. 使数据的处理和分析可以在保护数据隐私的前提下进行. 关注计算复杂度, 通信复杂度和安全性三个维度.
	- 安全多方计算协议 (Secure Multi-Party Computation, MPC).  (姚期智, 1982)
	- 姚式混淆电路 (Yao's Garbled Circuits. 姚期智, 1986). 不经意传输 (Oblivious Transfer) (Rabin, 1981).
	- 差分隐私 (Differential Privacy, DP). (C.Dwork, 2006)
	- [秘密共享和分拆协议](其他安全协议功能/秘密分拆协议.md). 如 (Shamir & Blakley 方案, 1979), SPDZ 协议, GMW 协议.
	- 同态加密 (Homomorphic Encryption, HE), 分为全同态 (FHE) (Gentry, 2009) 和部分同态 (PHE) (Paillier, 1999) 两种类型.
	- 零知识证明 (Zero-Knowledge Proof, ZKP). 
		- 交互式零知识证明 (IZKP). (Goldwasser, 1985)
		- 非交互式零知识证明 (NIZK), 如 zk-SNARK, zk-STARK, BulletProof (Rafael Pass, 2017)
	- 联邦学习 (McMahan, 2016)

### 安全性分析

安全协议要进行额外的**安全性分析**, 分析方法主要有: 
- 攻击检测方法, 采用已知攻击方法逐个尝试攻击协议.
- 形式化分析理论与方法, 如 [BAN 逻辑](BAN%20逻辑.md)
- [可证明安全](../可证明安全.md), 基于困难性问题归约证明

### 攻击手段


安全协议的主要攻击方法有: 
1. 已知明文攻击: 窃听.
2. 选择密文攻击
3. 预言者会话攻击 (Oracle-based Attack): 利用协议的正常接口, 构造试探性输入, 进入推测敏感数据.
4. 并行会话攻击 (Parrelle Session Attack): 假冒和重放攻击.

***

安全协议中所使用的符号定义:

| 标识符        | 含义                             |
| ------------- | -------------------------------- |
| $A$           | Alice 参与方                     |
| $B$           | Bob 参与方                       |
| $T$           | 时间戳                           |
| $R, Nonce$           | 选取的一次性随机数                     |
| $N$           | 时变值, 常见值为 $H(T+Nonce)$ |
| $K$           | 对称密钥                         |
| $PK, SK$      | 公私钥                           |
| $\set{M}_{K}$, $E_{K}(M)$ | 加密操作                         |
| $H(M)$        | 哈希操作                         |
| $H_{K}(M)$    | 带密钥的哈希操作, 一般指 $MAC$   |
