基于离散对数困难问题, 可以用于加密和签名. 

## ElGamal 加密

由于使用了随机数, 所以又称随机化加密. 使同一明文使用同一公钥加密产生的密文不同, 有效防御选择明文攻击和重放攻击等.

ElGamal体制效率没有RSA高, 并且消息长度有两倍膨胀.

### 1 密钥生成

1. 选取大素数q, 使求解离散对数问题在 $\mathbb{Z}_{q}$上困难
2. 选取 $\mathbb{Z}_{q}^*$ 上的本原元 $g$
3. 选随机整数 $X_{A}\in \left[1, q-2\right]$, 计算 $Y_{A}=g^{X_{A}}\pmod q$

则 Alice 的**公钥**为 $\{q, g, Y_{A}\}$, **私钥**为 $\{X_A\}$

### 2 加密

Bob 向 Alice发送消息 $M\in\left[1, q-1\right]$ :

1. 选取**一次性**随机数 $k\in \mathbb{Z_{q-1}}$
2. 计算一次性密钥 $K=(Y_{A})^{k}\pmod q$
3. ${} C_{1}=g^{k}\pmod q {}$
4. $C_{2}=KM\pmod q$

Bob 向 Alice 发送密文对 $\left(C_{1}, C_{2}\right)$

### 3 解密

Alice 恢复 $M=C_{2}(C_{1}^{X_{A}})^{-1}\pmod q$

**证明**:

$K\equiv(Y_{A})^{k}\pmod q\equiv (g^{X_{A}})^k\pmod q$

使用 $C_1$ 恢复出 $K$:  
$C_{1}^{X_{A}}=(g^{k})^{X_{A}}\pmod q$

使用 $K$和 $C_{2}$恢复出 $M$:  
$C_{2}\equiv KM\pmod q\equiv (g^{X_{A}})^{k}M\pmod q$

### 4 安全性分析

公开信道上有: $C_{1}$, $C_{2}$, $\{q, g, Y_{A}\}$, 要恢复 $M$, 就要恢复 $K=g^{k\cdot X_{A}}$, 但是敌手没有 $X_{A}$, 只有 ${} g^{k}$ 和 ${} g^{X_{A}}$, 由离散对数问题困难性, 没办法恢复出 $K$. 此时 $X_{A}$ 就是离散对数问题的单陷门信息.

安全性由如下困难性保证:  

1. 知道 $C_{1}=g^{k}$ 和 $g$, 无法解出 $k$
2. 知道 $Y_{A}=g^{X_{A}}$ 和 $g$, 无法解出 $X_{A}$

$k$ 和 $X_{A}$ 任一泄露, 明文都会泄露. 所以两者都是密钥.   
不加随机值 $k$ 的DH体制无法实现加密功能, 因为只需求 $Y_{A}^{-1}$ 即可解出 $M$

另外, ElGamal体制的随机数 **k 不能重复使用**:  
对于 $C_{1,2}=KM_{1}$, $C_{2,2}=KM_{2}$, 有 $\frac{C_{1,2}}{C_{2,2}}=\frac{KM_{1}}{KM_{2}}=\frac{M_{1}}{M_{2}}$. 若 $M_{1}$ 泄露, 所有使用该k加密的明文块皆泄露

***

## Elgamal 签名

### 1 密钥生成

1. 选取大素数q, 使求解离散对数问题在 $\mathbb{Z}_{q}$ 上困难
2. 选取 $\mathbb{Z}_{q}^*$ 上的本原元 $g$
3. 选随机整数 $X\in \left[1, q-2\right]$, 计算 $Y=g^{X}\pmod q$

则 Alice 的**公钥**为 $\{q, g, Y\}$, **私钥**为 $\{X\}$

### 2 签名

1. $m=Hash(M)$, M为待签字消息
2. 选择随机数 $k$, $S_{1}=g^{k}\pmod p$
3. $S_{2}=k^{-1}(m-XS_{1})\pmod {p-1}$, 注意选取 $(k,\ p-1)=1$

最终签名为 $Sig(X, M)=\{S_{1},\ S_{2}\}$, 以及 $M$

### 3 验证

1. $m=Hash(M)$, M为原始消息
1. $V_{1}=g^{m}\pmod p$
2. $V_{2}=Y^{S_{1}}S_{1}^{S_{2}}\pmod p$

3. 验证 $V_{1}\stackrel{?}{=} V_{2}$

**证明**

因为 $XS_{1}+kS_{2}=XS_{1}+kk^{-1}(m-XS_{1})=m \pmod{\phi(p)}$,  
所以 $V_{2}=Y^{S_{1}}S_{1}^{S_{2}}=g^{XS_{1}+kS_{2}}\pmod p=g^{m}\pmod p\equiv V_{1}$


### 4 安全性分析

#### 构造思路

使用 DLP 问题, 需在指数上用私钥 $X$ 构造签名, 但仅使用 $g^{X+hash(M)}$ 无法在签名同时保护 $X$.    
因此, 使用对外隐藏的临时密钥 $k$, 将*私钥 $X$对哈希值的签名 $hash(M)+X$*  加密, 同时公开临时公钥 $S_{1}=g^{k}$. 这样敌手即不能从签名推断出私钥 $X$ (不知 $k$), 也不能伪造签名(不知 $X$).

**为什么使用 $XS_{1}$ 而不是 $X$?** 保证签名唯一性



#### 攻击

攻击者伪造签名, 等价于破解私钥 $X$, 归约于离散对数困难问题.

$k$不能泄露, 且不能重复使用. 如果重复使用, 私钥 $x$将由下列方程算出:
$$\begin{align}
H(m_{1})=XS_{1}+kS_{1}\\
H(m_{2})=XS_{2}+kS_{2}
\end{align}$$

<br>

> ElGamal 签名存在较多变形, 见[数字签名算法汇总](Security/密码学/公钥密码/数字签名/数字签名.md), 如 Schenorr 和  DSA.

> ElGamal 协议也被构建于椭圆曲线有限域上, 见 [ECC-Elgamal](ECC/ECC-Elgamal.md)