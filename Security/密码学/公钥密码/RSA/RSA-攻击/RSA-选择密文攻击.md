**CCA, Choice CipherText Attack, 选择密文攻击**是针对 **Plain-RSA, 教科书式 RSA** 的有效攻击手段, 利用了 RSA 模乘运算的乘法同态性质. 通过 [OAEP 填充](../PKCS1.md)等引入随机的填充方式后, 让同一明文对应不同密文, 使敌手不能通过密文猜测明文模式, 从而增加 CCA 安全性.

### 攻击流程

假设敌手有选择密文攻击能力, 密文 $C$ 和明文 $M$, 选取随机数 $r$. 

此时敌手已知 $(C, e, N, r)$

1. 让 A 解密 $r^eC$. 因为 $r^eC=r^eM^e$, 所以解密结果为 $rM$
2. 计算 $r^{-1}\pmod{n}$
3. 计算 $M=r^{-1}\times rM\pmod{n}$

> 类似攻击还有: [RSA-篡改攻击](RSA-篡改攻击.md)

### 防御

简单地添加随机数也不能完全防御该攻击: 加密方选取随机数 $K$, 然后加密拼接值: $$(K\Vert M)^{e}=(K\times{2^{n}}+M)^{e}$$

二进制数直接拼接 (通过移位实现), 从十进制来看是乘以 $2^{n}$, 仍没有完全掩盖明文模式. 

攻击者选取随机数 $r$, 构造: $$r^{e}C=r^{e}(K\times 2^{n}+M)^{e}=(r\cdot K\times 2^{n}+r\cdot M)^{e}$$

攻击者声明随机数为 $r\cdot K$ (欺骗了谕示机, 但是仍符合解密流程), 让谕示机解密 $r^{e}C$, 得到 $$(rK\times 2^{n}+rM)$$, 同乘 ${} r^{-1}\pmod N {}$, 结果的最低 $n$ 位仍然是明文 $M$.

目前我认为相对简单并安全的方案是: $$M'=(K\Vert Hash(K)\oplus M)$$