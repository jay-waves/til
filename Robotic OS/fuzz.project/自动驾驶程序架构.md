![](../../attach/2024-03-23_16-00.png)

我们可以从常见的基于ROS2的自动驾驶机器人架构来理解整个ROS2系统的应用结构. 自动驾驶软件系统一般有三个核心部分: 传感器驱动 (Sensor Drivers), 感知 (Perception) 模块和导航行为树 (Navigator Behavior Tree). 每一部分扮演着在自动导航中不可或缺的角色, 每一部分都有多个ROS节点构成.

传感器驱动部分 (Sensor Driver) 负责收集机器人运行环境的原始数据, 由多种传感器构成. 其中, 
里程计驱动节点 (Odometery) 负责提供机器人在空间中的位置和姿态信息, 实时测量机器人相对于
起点的移动距离和方向变化来实现的, 将机器人运动状态信息通过话题发布给整个自动导航系统. 
关节传感器节点 (Joint) 监控机器人各个活动部件的状态, 用于进一步理解机器人活动状态. 扫描传感器（Scan）如激光雷达, 则用于生成和发布环境的三维点云数据，这些数据用于环境建模和障碍物检测。
这些传感器驱动节点是自动驾驶机器感知外部世界的感官，用于收集信息，并通过ROS话题将消息送入感知模块中进行进一步的处理。

》》》

感知模块的职责是对从传感器收集来的数据进行处理和解释，为导航提供必要的环境信息，是系统的
数据处理中心。这一模块包含一个变换器（Transformer，/tf2），它负责将不同来源的传感器数
据转换到统一的参考坐标系中，为进一步数据处理奠定基础。定位组件采用自适应蒙特卡洛定位
（AMCL）或同步定位与地图构建技术（SLAM）来确定机器人在环境中的精确位置。此外，为了有效
导航，感知模块会生成局部代价图和全局代价图，这两种地图根据机器人的实时位置和周围环境，映
射出可通行区域和障碍物的分布。

导航行为树则是决策和执行的核心，它基于感知模块提供的数据来执行导航任务。规划器（Planner）
会计算出一条从当前位置到目的地的最佳路径，这个计算过程是基于全局代价图完成的。控制器（Controller）则利用局部代价图规划出机器人短期的行进路线，以快速应对即将到来的障碍。平滑
器作为路径规划的最后一步，它将规划器和控制器生成的路径进行平滑处理，生成机器人的速度和方向
姿态指令，这些指令将直接影响机器人的运动，确保其行动的平稳与安全。

通过上述三大模块的紧密协作，navigation2软件能够在复杂多变的环境中实现机器人的稳定自主导
航。这种高度集成化的软件结构体现了现代机器人系统在环境感知、数据处理和动态规划方面的先进
能力，使机器人在执行任务时能够做出快速而准确的响应。

### 传感器驱动（Sensor Drivers）

传感器驱动是负责从物理世界中收集数据的模块。它包括：

- **里程计（Odometery）**：这是一个传感器，用于测量机器人相对于起始位置的移动距离和角度变化，提供位置和姿态（Pose）信息。
- **关节（Joint）**：关节传感器监测机器人关节的运动状态（States），例如旋转和伸展。
- **扫描（Scan）**：扫描传感器，如激光雷达，提供周围环境的三维点云（PointCloud）数据。
- **碰撞传感器（Bumper）**：用于检测机器人是否发生碰撞（Collision），以防止损害或事故。

### 感知（Perception）

感知模块是数据处理的中枢，主要负责解释传感器数据，并建立机器人与其环境的交互。它由以下组件组成：

- **变换器（Transformer）**：将来自不同传感器的数据统一到一个参考坐标系下，以便进行进一步处理。
- **定位（Localization）**：利用自适应蒙特卡洛定位（AMCL）或同步定位与地图构建（SLAM）技术来确定机器人在环境中的确切位置。
- **局部代价图（Local Costmap）**：在机器人周围创建一个局部的代价图，反映近距离的障碍物和通行区域，对局部路径规划至关重要。
- **全局代价图（Global Costmap）**：生成一个更广阔区域的代价图，它显示了整个环境中的障碍物和路径，用于全局路径规划。

### 导航行为树（Navigator Behavior Tree）

导航行为树是决策制定和行动指令执行的模块，确保机器人能够自主地完成导航任务。这个部分包括：

- **规划器（Planner）**：根据全局代价图（Global Costmap）规划一条从当前位置到目标位置的最佳路径（GoalPath）。
- **控制器（Controller）**：使用局部代价图（Local Costmap）计算短期内的最佳行进路线（Local Plan），以避开临近的障碍物。
- **平滑器（Smoother）**：优化由规划器和控制器提出的路径，生成平滑的速度（Velocity）指令，这些指令将被发送到机器人的关节差动轮（Joint Differential Wheels）执行。

这三个部分相互协作，通过各自承担的角色实现复杂的自动驾驶功能。传感器驱动层负责收集外部信息，感知层处理这些信息并生成导航所需的地图信息，而导航行为树则根据地图信息做出决策并控制机器人运动，实现环境中的自主导航。


