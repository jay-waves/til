## 替换

`:[scope]s/OLD/NEW/[g|c|i]`

- `scope`: 作用范围, 见下.
- `g, global`: 默认每行仅匹配第一个, `g` 匹配每行所有.
- `c`: 开启二次确认
- `i`: 大小写不敏感, `I` 反之.
- 可以使用正则表达式匹配.
- `/` 分隔符可以用 `=` 或 `+` 替换.

## 查找

- `/{pattern}`
- `n, N` 下一个/上一个匹配项
- `*` 查找当前光标所在的单词

```vim
*
:%s//hello/g        " // 表示上一次的搜索模式
```

## 全局命令

在所有符号条件的行上执行某命令

```vim
:[scope]g/{pattern}/{cmd}
:global /regexp/ print
:global!  
:vglobal
```

- `cmd` 只能是冒号命令.
- 默认作用范围为整个文件.

> `:global /regexp/ print` 的缩写是 grep. grep 程序的作者 Kenn Thompson 就是受 vi `:global` 命令的启发. https://robots.thoughtbot.com/how-grep-got-its-name
>
> `:h :global`

## 行范围, Ranges

大部分命令默认作用于当前行, 可以加**行范围字段**来修改作用域. 仅有 `write`, `global` 是默认作用域全部行. 范围的表示形式很灵活:

| 命令, 以 `delete, d` 为例 | 选中的范围                                          |
| ------------------------- | --------------------------------------------------- |
| `:d`                      | (删除)当前行                                        |
| `:.d`                     | 当前行                                              |
| `:1d`                     | 第一行                                              |
| `:1,3d`                   | 第1行至第3行                                        |
| `:$d`                     | 最后一行                                            |
| `:1,$d`, `:%d`            | 所有行                                              |
| `:.,5d`, `:,5d`           | 当前行至第 5 行                                     |
| `:,+3d`                   | 当前行及接下来的 3 行                               |
| `:1,$-3d`                 | 第1行至倒数第3行                                    |
| `:,-3d`                   | 当前行及向上的 3 行                                 |
| `:3,'xdelete`             | 第三行至[标注](#标注) 为 x 的那一行                 |
| `:/^foo/,$delete`         | 当前行以下，以字符 "foo" 开头的那一行至结尾         |
| `:/^foo/+1,$delete`       | 当前行以下，以字符 "foo" 开头的那一行的下一行至结尾 |
| `'<,'>`                   | visual 下选中区域                                   |
| `:1,+1d`                  | 删除第一行至当前行的下一行                          |
| `:1;+1d`                  | 删除第1行至第2行                                    |
| `:'a:'bd`                 | 从标记 a 所在行删除到标记 b 所在行 (注意 `` ` `` 不行)                                                    |

> 更多帮助: `:h cmdline-ranges`, `:h range`

***

### 元字符

元字符指 vim 支持的正则表达式中, 具有特殊意义的字符.

| 元字符   | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| `.`      | 匹配任意一个字符                                             |
| `[abc]`  | 匹配方括号中的任意一个字符. 可用 `-` 表示范围, 如 `[a-z0-9]` |
| `[^abc]` | 匹配除方括号中字符之外的任意字符                             |
| `\t`     | 匹配 `<TAB>` 字符                                            |
| `\s`     | 匹配空白字符                                                 |
| `$, ^, \<, \>`      | 匹配位置                                                     |
| `\n`     | 匹配换行符                                                   |
| `\_`     | 匹配....                                                     |
| `\+, \?, *, \{n,m}`     | 表示匹配数量                                                     |
| `\*, \., \\, \[` | 转义, 匹配保留字符         |          


### 匹配组

- `\(...\)` 捕获组
- `\1` 获取对应编号的组
- `\0` 匹配全部内容

```vim
" 匹配开头结尾处 a 个数相同的字符串. 使用上下文文法.
/\(a\+\)[^a]\+\1     

" 将 URL 替换为 <a href=URL>URL</a> 的格式
:s/\(http:\/\/[-a-z\._~\+%\/]\+\)/<a href="\1">\1<\/a>/  

" 将 data1 data2 修改为 data2 data1
:s/\(\w\+\)\s\+\(\w\+\)/\2\t\1                            
```
