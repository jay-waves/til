## 临时文件

根据选项的不同, Vim 最多会创建 4 种工作文件. 

### 备份文件

`:set writebackup` 在写入前先备份文件, 当文件新的修改被保存时, 备份立即被删除.

`:set backup` 在写入前备份文件, 有修改保存时不删除备份. ( `:set nobackup` )

借助备份, 查看文件历史改动: (和临时历史不同)

```sh
$ diff ~/.vim/vimrc ~/.vim/files/backup/vimrc-vimbackup
390d389
< command! -bar -nargs=* -complete=help H helpgrep <args>
```

> 帮助见 `:h backup`

### 交换文件

编辑文件时, Vim 会创建一个临时交换文件, 里面是**当前未保存的所有修改**. 用 `:swapname` 获取交换文件路劲, 默认是在同文件夹下的隐藏文件, 以 `.file.swp` 结尾. 用 `set noswapfile` 来禁用交换文件.

断电时, 该文件并不会被删除. 提供了一定的容灾恢复, 服务器中不建议移动 `.swp` 的默认位置, 否则多个用户同时编辑同一文件时, 不会得到警告.

> 帮助见 `:h swap-file`, `:h usr_11`

### 撤销文件

内容变更历史记录是保存在内存中的, 并且会在 Vim 退出时清空. 如果想让它持久化到磁盘中, 可以设置 `:set undofile`. 这会把文件 `~/foo.c` 的撤销文件保存在 `~/foo.c.un~`.

> 帮助见 `:h 'undofile'` 和 `:h undo-persistence`

### viminfo 文件

备份文件, 交换文件和撤销文件都是与文本状态相关的. 而 viminfo 文件是用来保存在 Vim 退出时可能会丢失的其它辅助信息的, 包括: 历史记录 (命令历史, 搜索历史, 输入历史), 寄存器内容, 标注, 缓冲区列表, 全局变量等等.

默认情况下, viminfo 保存在 `~/.viminfo`, 非易失.

> 帮助见 `:h viminfo` 和 `:h 'viminfo'`

***

将所有临时文件放到 `~/.vim/files` 中管理:

```vim
" 如果文件夹不存在，则新建文件夹
if !isdirectory($HOME.'/.vim/files') && exists('*mkdir')
  call mkdir($HOME.'/.vim/files')
endif

" 备份文件
set backup
set backupdir   =$HOME/.vim/files/backup/
set backupext   =-vimbackup
set backupskip  =
" 交换文件
set directory   =$HOME/.vim/files/swap//
set updatecount =100
" 撤销文件
set undofile
set undodir     =$HOME/.vim/files/undo/
" viminfo 文件
set viminfo     ='100,n$HOME/.vim/files/info/viminfo
```
