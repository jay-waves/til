## 数据链路层

数据链路层三大问题:
- 封装成帧 (frame)
- 透明传输: 帧封装不会对数据内容产生限制.
- 差错检测:

### 帧定界

SOH, start of header, `0x01`; EOT, end of transimission, `0x04`. 是 ACSII 码中规定的通信专用字符.

帧的数据载荷长度上限, Maximum Transfer Unit, MTU. 以太网 `MTU= 1500 bytes`

### 透明传输

数据中二进制码恰好和 `SOH`, `EOT` 重复, 就会误解帧的边界. 解决办法是**字节填充**.

当数据中出现通信专用字符时, 在进入数据链路层时, 在通信字符前插入 `ESC=0x1B` 转义字符; 在离开数据链路层时, 删除插入的 `ESC`.

例子:  

```
原始数据:

(SOH) EOT SOH ESC (EOT)

数据链路层数据:

SOH  ESC EOT  ESC SOH  ESC ESC  EOT
```

### 差错检测

错误检测机制, FCS, Frame Check Sequence. 常用方法有**奇偶校验, 汉明码, 循环冗余校验**, 传输层还使用反码求和校验. FCS 附加在数据帧尾部.

## 协议

| 名称                   | 标准        | 报文 |
| ---------------------- | ----------- | ---- |
| 以太网, Ethernet       | IEEE 802.3  | MAC  |
| 无线局域网, Wi-Fi      | IEEE 802.11 | MAC  |
| 点对点协议, PPP        | RFC 1661    | HDLC |
| 高清晰度链路控制, HDLC |  ISO 13239           | HDLC     |

## MAC 帧

若数据跨网络发送, 源和目的 MAC 地址会不断改变: 
1. 由路由协议决定下一跳的 IP 地址
2. 用 ARP 协议在同网段获取下一跳 IP 地址对应的 MAC 地址
3. 路由设备修改当前报文的MAC帧:
	- 将以太网报文中源 MAC 地址改为当前设备的 MAC 地址
	- 将目的 MAC 地址改为下一跳 IP 对应的 MAC 地址
	- 重新计算 FCS. 
4. 下一跳设备接收到该报文后, 检验 FCS, 然后移除数据链路层头部和 FCS. 重复上述.

```
  0   1   2   3   4   5   6   7   0   1   2   3   4   5   6   7
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
|                          Frame Control                        |
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
|                          Duration/ID                          |
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
|                                                               |
|                     Address 1 (Receiver) 48b                  |
|                                                               |
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
|                                                               |
|                  Address 2 (Transmitter) 48b                  |
|                                                               |
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
|                                                               |
|                    Address 3 (Filtering) 48b                  |
|                                                               |
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
|                          Sequence Control                     |
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
|                          Frame Body (data...)                 |
                            .....
|                                                               |
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
|                                                               |
|                   Frame Check Sequence 32b                    |
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
```
