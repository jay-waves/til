发送邮件: 将邮件**发送**到接收方的邮件服务器, 如 SMTP 协议

接收邮件: 从邮件服务器**接收和管理**收到的邮件, 如 POP3/IMAP 协议

## SMTP

SMTP (Simple Mail Transfer Protocol) 专用于发送邮件.

- 底层协议: tcp
- 端口: 25
- 通信方式: client-server

**连接建立流程**:
1. *客户端 - 邮件 -> 发送方邮件服务器* (注意, 这里可能用到 http 协议, 如 gmail 网页版; 也可能是 smtp 协议, 如旧 outlook 客户端)   
2. 发送方服务器扫描到新邮件, 与接收方邮件服务器建立 tcp 连接
3. 建立 tcp 后, 发送 `220 Service ready`
4. 发送 `Hello`, 测试接收方状态
5. 接收方有能力接受, 回复 `250 OK`; 无能力接收, 回复 `421 Service not available`

**邮件发送流程**:
1. 发送方服务器发送 `MAIL FROM: <xxx@qq.com>`
2. 接收方邮件服务器 回复 `250 OK`; 未准备好, 回复 `451/452/500` 等
3. 发送 `RCPT: <xxx@qq.com>`, 可群发
4. 接收方邮件服务器验证改用户存在, 回复 `250 OK`; 否则回复 `550 No such user here`
5. (开始传输数据), 发送方发送 `DATA` 命令
6. 接收方再次检查状态, 回复 `354 ...` 即同意接收数据.
7. 发送方传输邮件内容, 接收方收到全部数据则回复 `250 OK`

**断开连接流程**:
1. 邮件发送完毕后, 发送方发送 `QUIT` 命令
2. 接收方服务器同意断开, 回复 `221`, 释放 tcp 连接.
3. 后续接收方邮件客户端从接收方邮件服务器下载和管理收到的邮件, 则需要用到 POP3/IMAP 等协议.

### MIME

SMTP 仅可以传输 7 位 ASCII 码表示的英文文本, 并且有长度限制. MIME (通用因特网邮件扩充协议) 对 SMTP 协议进行了扩展. 具体而言, MIME 将非 ACSII 码数据 (如其他语言, 音视频, 图片等) 通过 [Base64 编码](字符编码/Base%20编码.md)转换为 ASCII 码数据, 然后调用 SMTP 协议进行传输.

## POP3 & IMAP

POP3(Post Office Protocol 3)是第一个离线协议标准, 用于从服务器下载邮件到客户端. 为了兼容性和邮件应用针对性优化, 邮件接收和管理一般采用 POP3/IMAP 这样的专有协议.

- 底层协议: TCP
- 端口号: 110
- 加密端口 (SSL/TLS): 995
- 通信方式: client-server

IMAP (网际报文存取协议, Internet Message Access Protocol) 比 POP3 更复杂先进, 在下载邮件功能基础上添加了更多对邮件组织管理的功能.

- 底层协议: TCP
- 端口号: 143
- 加密端口号: 993
- 通信方式: client-server

|                       | POP3                       | IMAP                                                  |
| --------------------- | -------------------------- | ----------------------------------------------------- |
| 服务器存储邮件        | 下载后删除(可配置保留副本) | 默认邮件全部存储在服务器上                                 |
| 多设备同步            | 主要支持单设备, 移动/删除/已读邮件等操作仅影响客户端本地文件         | 支持多设备邮件状态同步, 如对服务器邮件读取/删除/移动/完整历史 |
| 选择性下载 (邮件预览) | 不支持, 必须下载整个邮件   | 支持预览邮件头部, 打开时再下载全文和附件              |
| 文件夹                | 不支持                     | 服务器支持文件夹收纳邮件                                                      |

## PGP

pgp (pretty good privacy) 用于邮件加密. 详见 [PGP](Network/应用层/PGP.md)