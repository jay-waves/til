## 网络设备拓扑

### 三网融合

三网一体化指**通信网络, 计算机网络和广播电视网络**三者都向计算机分组交换网络融合, 共享基建 (Everything on IP). 

#### 计算机网络

计算机网络 (Computer Network)是指计算机间的信息传输网络. 物理层和数据链路层遵循有线以太网 (Ethernet) 协议和无线 Wi-Fi 协议, 核心技术是分组交换 (Packet Switching). 

分组交换有两种方式:
- *虚电路 (Virtual Circuit) 方式*. 虚电路是面向连接的, 在网络中建立一条逻辑连接, 所有报文沿着该路径按顺序发送.
- *数据报 (Datagram) 方式*. 无连接, 只指定终点, 可能失序并沿着不同路径在网络中传输.

分组交换是逐段占用通信资源的, 资源利用效率高. 但由于每个分组都需要首部控制信息, 因此增加了开销和排队时延.

#### 通信网络

[通信网络](../Information/信号与通信/无线通信技术.md) (Telecommunications Network) 主要指无线通信设备的信息传输网络. 现代通信使用特有的物理层及数据链路层协议, 在网络层及以上和计算机网络共享.

2G 和 3G 仍使用运营商的**电路交换电话网络**来语音通话, 通话时为双方保留专用通道, 保证通话流畅. 蜂窝 (Cellular) 流量数据则使用**数据分组交换网络**, 不开辟专用数据通道. 随着网络速度提高, 分组交换网络也能满足语音通话的实时性需求, 因此 4G 和 5G 使用 VoLTE (Voice over LTE) 技术, 让语音和网络流量共享网络基础设施.

无线通信标准由 3GPP 计划提出, 将无线通信分为不同功能的多个协议层次:

| 网络层次   | 协议名                                  | 功能                                     | 首次提出  |
| ---------- | --------------------------------------- | ---------------------------------------- | --------- |
| 数据链路层 | MAC (Medium Access Control)             | 封装成帧 (MAC PDU), 并控制物理层传输     | 3GPP UMTS |
| 数据链路层 | RLC (Radio Link Control)                | 分段, 重组, 错误检测, 和重传 (可靠传输)  | 3GPP UMTS |
| 数据链路层 | PDCP (Packet Data Convergence Protocol) | 压缩,加密, 完整性保护. 数据包排序和去重  | 3GPP LTE  |
| 数据链路层 | SDAP (Service Data Adptation Protocol)  | 处理不同应用的 [QoS](网络层/QoS.md) 需求 | 3GPP NR   |
| 网络层     | [AKA](../Security/密码学/安全协议/认证的密钥协商协议/AKA%20协议.md) (Authentication and Key Agreement)  | 用户身份安全性认证                                         | 3GPP UMTS |
| 网络层     | IP (VoIP)                                     | 从此开始接入计算机网络上层结构           |           |

#### 电视电话网络

电视电话网络 (电信网络, Telephony/Videophone Network) 主要指公共电话网, 固定电话网以及电视广播服务. 

### 计算机网络设备

核心层有两个三层交换机, 负责负载均衡 (Load Balancer) 和热备份.

出口路由器由两个不同运营商提供, 提供对公网路由.

交换机 (Switch): 在局域网 (LAN) 中转发数据包, 二层交换机 (以太网交换机) 工作在数据链路层. 三层交换机工作在网络层, 兼顾交换和路由功能.

路由器 (Router): 在广域网 (WAN) 和局域网间转发数据包, 工作在网络层, 需要用拓扑算法和IP路由表决定最佳路由路径.

集线器 (Hub): 只支持一个网络域的网桥. 交换机则能同时连接多个网络域.

### 安全设备

- 防火墙 (FireWall): 流量控制, NAT, VPN, 流量过滤. 属于**访问控制类**产品.
- IPS (Intrusion Prevention System): 入侵检测与防御. 属于**访问控制类**产品.
- IDS (Intrusion Detection System): 入侵检测, 被动不防御. 通常为 TAP (Test/Traffic Access Point) 设备, 监听和转发网络流量. 属于**审计类**产品.

其中, 防火墙一般通过扫描报文的端口和地址来访问控制, IPS 则可以深入检测攻击内容, 如异常的请求头和请求体. 通常出于成本原因防火墙在IPS流量前, 但实际场景中, 某些组织需要对特定流量进行深入检查, 可能将IPS放在防火墙后; 还有将防火墙和IPS结合一起的设备, 称为下一代防护墙(NGFW).

![|700](../attach/网络拓扑图%20v3.0.avif)

...家庭网络层次...

[**IPS/IDS:**](Network/防火墙/IDPS.md)
- IDS: Intrusion Detection System, 检测非法入侵, 记录日志, 并告知系统管理员.
- IPS: Intrusion Prevention System, 通过协议和程序拦截非法入侵, 并反击(伪装).

IPS/IDS 能检测:
- Dos 攻击.
- P2P 造成的信息泄露.
- 运行蠕虫, 特洛伊木马, 键盘记录器等恶意软件.
- 入侵局域网和入侵侦查行为

#### DMZ区

Demilitarized Zone, 非军事化区, 隔离区. 用于对外服务, DMZ区域对内网访问有限制策略.

黑客攻破DMZ, 也很难进入内网区域.

在更复杂或更严格的网路中, DMZ区域会和内网用*网闸*完全"断开式"隔离开.

总体而言, 访问控制需要做到:
- 内网可以访问外网, 可以访问其他区域内网.
- 内网可以访问DMZ
- 外网不能访问内网
- 外网可以访问DMZ
- DMZ访问内网有限制.
- DMZ不能访问外网. (有例外, 如邮件服务器)

DMZ 区域还会放*堡垒机 (Bastion Host)*, 运维人员通过它作为跳板访问内网服务器. 本质是通过 Windows RDP, FTP 或 SSH 技术远程访问服务器进行维护或操作. 运维人员先连接到堡垒机, 在堡垒机上远程登录内网服务器, 期间行为操作被堡垒机记录, 方便安全审计.

早期网络设备性能较差, 需要划分不同权限的网络分区, 分区内部则不设限. 现代 *零信任模型* 则不强调服务器的拓扑位置, 虽然仍部署在内网, 但是任何来源的访问都需要额外的身份验证和加密保护. 

#### 网络拓扑安全性

(Topology Risk)
1. 安全隔离不足
2. 流量监控存在盲点
3. 单点故障, 单点称为流量瓶颈
4. 响应延迟, 安全设备离流量入口过远或性能过差, 导致对入侵行为响应缓慢.

### 云服务

CDN, WAF, ....

### 数据中心架构

**两地三中心**架构 = 同城双中心 + 异地灾备中心

同城双中心指同城或临近城市建立两个可独立承担系统业务的数据中心. 两者能力接近, 并可通过高速链路近乎实时同步数据. 日常可同时分担业务 (Active-Active) 平衡负载, 也可切换运行 (Active-Passive) 用于热备份.

异地灾备中心, 指在异地建立数据备份中心, 定义备份数据. 当双中心受不可抗力影响而故障时, 异地灾备中心作为"冷备份"用于恢复数据.

### 电视网设备

*光猫 (光纤调制解调器,GPON, EPON Modem)* 负责将运营商 (ISP) 的光纤信号转换成数字电信号, 为内部网络提供网络接入. 一般有一个光纤接口连接 ISP 的光纤网络, 还有以太网接口用于将数字信号传递给路由器或网络设备.
