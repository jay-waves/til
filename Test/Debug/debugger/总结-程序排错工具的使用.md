
# WorkFlow 内容概览
==以实际顺序为准==
- 探索工具（以vscode为例，几大最常用工具）
	1. 工具解析
		- vscode+gdb(或vs)
	2. 查看变量技巧
		- 查看的不同姿势
		- 简单gdb查看语句(直接编辑查看语句)(调试控制台)
		- printf方法
	3. 断点类型和使用技巧
		- 按钮(功能)
		- 内联断点: 调试for语句
		- 条件断点
		- 命中次数
		- 断点与代码风格
		- 运行/跳转到光标处
- 实际应用(实际场景和方法)
	- 模拟测评机环境(面向考试编程): linux环境(命令行环境), freopen命令, 测评机常见错误
		- (2. 程序点sigsegv，注意观察数组访问越界和指针未申请内存问题，程序点tle注意观察死循环问题，期间可以结合单步调试进行。)
	- 调用栈堆(调试递归程序)
	- 自行构造易错数据
- 经验总结(不断记录bug文档）
	- 记录易错程序片段: 如fgets没有处理\\n, 比较浮点数直接用了==
		- 你不知道会不会第二次栽倒同一个坑上, 这样印象也更深
	- 学会提问: 转, so, 知乎, 学校论坛
	- 附录1: windows VS debugger的一些配置事项
	- 附录2: vscode常用快捷键
	- 附录3: launch.json的使用(传参)

***

# 1 探索工具

## 1.1 工具概述
c语言, 
- 常见**编译器**是: gcc和clang, 
- 常见的**Debugger**是: gdb或VS(Visual Studio)
对于debugger, 调试操作和功能基本相同, 本文不作区分和辨别; 需要注意的是, 刚接触的同学往往会认为程序"运行"和"调试"差不多, 其实不然, 调试需要进行更复杂的工具设置, 两者完成的工具也完全不同.

- 常见**Editor**或者**IDE**有: vsCode, DevC, CodeBlock, VS
其中, DevC开源并已经停止维护; vsCode是新兴编辑器, 界面美观, 功能多样, 定制化程度高. 但vsCode内存占用大, 并且配置复杂, 好上手但难精通。
VS配置方便却不够轻量, 但我墙裂推荐大家使用VS这样的现代IDE就行debug, 真的非常爽非常好用.
虽然但是, *本文使用vsCode进行演示, ==虽然调试功能近似, 但不同编辑器操作区别会较大.== 下图为常见vsCode工作区*
![[../../../attach/Pasted image 20220626163654.png]]

对于调试内容的介绍, 大家重点看基础功能. 其他部分, 后续实践中自己慢慢就会用了, 不必心急.

## 1.2 查看变量

### 1.2.1 为什么要查看变量?
程序出现bug, 就需要第一时间定位问题. debugger提供了一种定位问题的方式:  ==通过在程序中途添加中断点(断点), 让程序从一次性运行至结束, 变为在运行途中暂停几次==, 暂停后, 通过**查看变量**, 能够观察此时程序各个变量是否符合你对其预期, 即是否此时变量值出现问题.

### 1.2.2 查看的不同的姿势?

#### 添加"查看"
1. "添加变量", "添加到监视"
*将某个变量添加到监视栏, 在调试过程中时刻监视其变化.*
光标选中, 后右键"添加到监视", 如:
![[../../../attach/Pasted image 20220626164531.png|300]]
2. 光标查看
鼠标悬浮并停留于某一变量之上(或选中), 会自动弹出此时变量的值
![[../../../attach/Pasted image 20220626164802.png|150]]
3. 本地变量 "Locals"
指当前程序局部的变量(如当前函数内部变量), 此部分变量vscode自动显示. 并且可以显示**局部内函数的返回值**, 这是一个比较好用的功能.

#### gdb查看语法

可查看的变量, 包括程序中的变量, 但不局限于程序中的变量. 变量监视栏是可以自主修改的, 进一步可以感受到, 它其实是某种语句或命令, 即gdb命令. 可视化的调试当然很强, 但命令行一些高级操作它是实现不了的.

1. 语句块整体查看
	初学时犯了一个错误, 认为只能查看单个变量; 其实监视栏能查看的东西很多, 最常见的, 它可以查看一整个表达式:
	> `(i+j+k)/3`
	> `(i==j)&&(j>k)` 可用于*直接查看整个if语句的判断值正误*
2. [[查看变量&内存#以其他进制查看变量|不同进制查看]]
修改表达式即可, 变量名后接 `,+cmd`
- `val, b` 以二进制形式查看
- `val, x` 以十六进制形式查看
- `val, o` 以八进制形式查看
- `val, f` 以浮点数形式查看
- `val, s` 以字符串形式查看
	类似等等, 某些gdb命令或参数可视化debugger中是可以兼容的, 但大部分不行. 部分可以在**调试控制台**或者**终端**进行命令控制
3. 强制类型转换
	通过查看"表达式", 用表达式的方法对变量进行强制类型转换.
	> 示例: 使用类哈希表时, 可能使用字符的ascii码作为数组下标参考, 此时要查看实际下标, 可以利用`(int) ch`
4. [[查看变量&内存#查看指针指向的一整块内存|查看整块内存]]
	调试指针时, 部分指针指向的虽然是连续内存, 但监视栏并不能正确显示. (如malloc开辟的内存, 调试指针只显示1byte的内存) 可以利用`ptr, size`的形式, 查看ptr指针指向的size\*byte的整块内存
	
	> 示例: 从a[10]开始查看a数组的接下来size\*bytes大小数据, 使用`&a[10], size`其中`&`取地址, 类似指针行为, 说明调试命令其实接受的是地址而不是指针. 对比图: 
	![[../../../attach/Pasted image 20220626175455.png|200]]
	>进一步能否发现, 当内存指向的是'连续且以\\0结尾的字符串'时, 监视栏总能正确识别接下来的部分内存; 但若指向的内存不规律, 则不能自动识别, 只会返回指针类型对应的内存大小.

#### printf语句--借助输出进行调试

在程序中通过printf输出某中间变量的值, 好处是嵌入程序中不影响正常运行, 并且适合观察程序中变量的变化. 通过"运行"而非"调试"进行快速侦测异常.
1. 程序异常终止
当程序规模较大且运行异常时, 通常会先定位问题出现在程序的哪一个模块(部分), 即究竟是程序的哪一个功能模块运行异常,甚至卡退. 常见的方法有添加断点然后f5继续运行(后续介绍), 但我更喜欢在程序不同部分间加printf来检测程序执行情况. 这样的好处是, printf语句很难出现错误, 如果从某个printf开始未正常运行, 很大可能就是它上面的模块出现了异常.(如死循环, 访问越界等)

> 示例
 ```c
	//模块1
		printf("模块1运行结束");
	//模块2
		printf("模块2运行结束");

	//output$  模块1运行结束  $end output 
```
> 仅输出了第一个printf语句, 说明模块2出现异常, 程序退出(exit)

2. 查看循环中变量变化, 快速可视化反应异常
循环中变量值的改变是否符合预期? 打断点一步一步执行效率较低, 在循环内添加printf, 就能一次执行, 查看整个过程中变量的变化.

> 示例
```c
//查看阶乘
for(i=1, sum=1; i<n; i++){
	sum*=i;
	printf("%d\n", sum);//每次循环都进行查看
}
``` 

## 1.3 断点

### 1.3.1 为什么要使用断点?
为程序添加中断点, 让程序从完整执行变为分部分执行, 从而通过"查看变量"检查各模块是否如预期般工作.
添加断点很简单, 在程序主体对应行的最左侧点击即可,点击后左侧会出现一个红点标记该行, 意味着调试时程序会在改行暂停.常见快捷键是F9

### 1.3.2 功能按钮
![[../../../attach/Pasted image 20220626162323.png|200]]
使用vscode调试时会出现上图按钮(其他调试工具都有类似功能栏), 从左到右对应功能分别为: `继续运行, 单步跳过, 单步调试, 单步跳出, 重新开始, 中止调试`

#### 单步调试/f11:
最常用功能, 它有两个特性:
1. 会进入函数等局部作用域内部. 
	- 如果不小心进入, 可以`单步跳出/F11+shift`回到函数栈堆中的上一调用作用域 (通俗讲为从当前函数内部跳出去, 回到原本的主体程序).
	- 某种 **设置** 中, F11设置还会跳入库函数内, 比如跳入含`printf`函数的stdio库中. 有些debugger(如vs)支持这种操作(虽然使用起来很蛋疼), 但有些debugger会因打不开stdio直接卡退. 解决办法就是使用F10(后述)
2. 逐行前进, 绝不跳行.
	- 刚接触的同学常有疑惑: 为什么单步调试不直接跳到我设置的下一个断点? 这其实和`继续进行`这一功能混淆了(后续介绍), 程序第一个单步调试会跳到第一个断点(这其实是为了方便, 毕竟希望从头开始一步一步调试的情况很少, 大部分debug行为都是希望从第一个断点开始), 但是后续F11只会逐行向后前进.

#### 继续运行/f5:
程序继续运行, 直到下一个断点. 刚接触的同学可能会畏惧这个功能, 因为如果某个断点后续没有其他断点的话, 程序会直接运行结束(常常还会自动将调试窗口关闭,这是某种 **设置**); 或是, 觉得F5这个快捷键像是要重新开始调试. 但F5恰恰是他们希望的"直接运行到下一个断点"这一功能, 可以如此理解: 我们用断点将程序分隔成不同部分, 摁一次F5就执行一部分程序.
> 示例:
> 1. ==当你用单步调试和单步跳过都无法从循环中跳出来时, 可以在循环后添加一断点, 然后F5即可跳过循环== 鄙人刚接触时, 就是不理解这一点, 只会单步执行, 导致不会调试循环, 甚至有一段时间极力避免写循环程序结构.
> 2. 在程序不同功能模块后添加断点, 快速运行和跳跃各个模块, 排查错误. 适合配合printf检查大型程序各模块运行情况.

#### 单步跳过/F10
从名称上易与F5功能混淆, 实际上其功能更类似F11,但有区别.
1. 逐行前进, 而不是在断点间跳跃.
2. 不会进入函数等局部作用域内部, 不论是库函数还是自定义函数

### 1.3.3 高级断点类型:

#### 内联断点(行内断点)
c语言常常会碰见讨厌的程序, 一行程序逗号连着好几个语句; 就算正常程序, for语句一行三个小语句也很难进行调试. 
 有两种解决方案, 一种方案是使用代码格式化工具, 另一种方案则是为这种讨厌的行添加行内断点. vscode中快捷键是光标定位+shift+f9
 行内断点功能和正常断点类似，会在其位置暂停.
#### 条件断点
该类型断点需预设条件, 当经过该断点且满足条件时, 程序会暂停; 否则程序不会暂停. 
- ==非常有用==, 比如某个循环结构中, 我想直接观察第99次循环的情况(假设循环标的为i), 那么我就可以添加条件断点`i==99`, 这样程序就会在第99次循环时才停止. 
- 使用方式: vscode中为右键点击最左侧添加断点列, 就会出现包含条件断点等特殊类型断点的上下文菜单.
#### 命中次数
在条件断点的基础上, 可以设置命中次数. 比如我想让某个条件为真三次时停止, 即程序经过该断点行, 且判断该断点行的条件为真, 且上述两条件已经被满足了两次(现在是第三次), 那么程序中断.
#### 运行/跳转到光标处
, 跳转是可以跳到已经执行过的程序位置的(相当于又执行一遍罢了)

==未完待续==
***

# 2 实践应用

## 2.1 调用栈堆

## 2.2 命令行环境 / linux环境
模拟测评机
### 2.2.1 freopen()的利用(文件输入)

## 2.3 琢磨测评机和作业
### 2.3.1 错误类型
### 2.3.2 构造易错数据 / debug工作流

***

# 3 经验总结

## 3.1 记录文档

### 3.1.1 总结自身易错程序片段
snippets

## 3.2 学会提问


***

# VScode配置附录
较深入理解
## 附录1: VScode调试文件lanuch.json的应用和配置

## 附录2: VScode快捷键, 及其配置

## 附录3 Windows VS Debugger的一些注意事项

***

# 引用

如何学会提问? 为什么要学会提问

windows vs配置文档

大学中如何获取知识:https://www.cnblogs.com/BUAA-Wander/p/14161831.html

***

重要的是一颗好奇心:luc_heart: